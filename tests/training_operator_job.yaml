# from https://github.com/kubeflow/training-operator/blob/master/examples/pytorch/simple.yaml
# and disabled istio as stated in the documentation https://www.kubeflow.org/docs/components/training/user-guides/pytorch/
apiVersion: "kubeflow.org/v1"
kind: PyTorchJob
metadata:
  name: pytorch-simple
spec:
  pytorchReplicaSpecs:
    Master:
      replicas: 1
      restartPolicy: OnFailure
      template:
        metadata:
          labels:
            sidecar.istio.io/inject: "false"
        spec:
          containers:
          - name: pytorch
            image: docker.io/kubeflowkatib/pytorch-mnist:v1beta1-45c5727
            imagePullPolicy: Always
            command:
            - "python3"
            - "/opt/pytorch-mnist/mnist.py"
            - "--epochs=1"
            - "--no-cuda"
            - "--batch-size=128"
            - "--log-interval=5"
            - "--lr=0.1"
            env:
            - name: PYTHONUNBUFFERED
              value: "1"
            resources:
              requests:
                memory: "400Mi"
                cpu: "400m"
              limits:
                memory: "800Mi"
                cpu: "800m"
    Worker:
      replicas: 1
      restartPolicy: OnFailure
      template:
        metadata:
          labels:
            sidecar.istio.io/inject: "false"
        spec:
          containers:
          - name: pytorch
            image: docker.io/kubeflowkatib/pytorch-mnist:v1beta1-45c5727
            imagePullPolicy: Always
            command:
            - "python3"
            - "/opt/pytorch-mnist/mnist.py"
            - "--epochs=1"
            - "--no-cuda"
            - "--batch-size=128"
            - "--log-interval=5"
            - "--lr=0.1"
            env:
            - name: PYTHONUNBUFFERED
              value: "1"
            resources:
              requests:
                memory: "400Mi"
                cpu: "400m"
              limits:
                memory: "800Mi"
                cpu: "800m"
