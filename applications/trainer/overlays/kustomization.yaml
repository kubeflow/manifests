apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: kubeflow-system

resources:
- ../upstream/overlays/kubeflow-platform

patches:
- target:
    group: apps
    version: v1
    kind: Deployment
    name: jobset-controller-manager
  patch: |-
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: jobset-controller-manager
      namespace: kubeflow-system
    spec:
      template:
        metadata:
          annotations:
            traffic.sidecar.istio.io/excludeInboundPorts: "9443"
        spec:
          securityContext:
            seccompProfile:
              type: RuntimeDefault
- target:
    group: apps
    version: v1
    kind: Deployment
    name: kubeflow-trainer-controller-manager
  patch: |-
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: kubeflow-trainer-controller-manager
      namespace: kubeflow-system
    spec:
      template:
        metadata:
          annotations:
            traffic.sidecar.istio.io/excludeInboundPorts: "9443"
        spec:
          securityContext:
            seccompProfile:
              type: RuntimeDefault
