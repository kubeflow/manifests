# Platform-agnostic values for Kubeflow Pipelines
# This configuration uses local storage (MinIO) and MySQL

# Environment configuration
env:
  platform: platform-agnostic

# Database configuration - use built-in MySQL
mysql:
  enabled: false
  auth:
    rootPassword: ""
    database: "mlpipeline"
    username: "root"
  primary:
    persistence:
      enabled: true
      size: 20Gi

postgresql:
  enabled: false

externalDatabase:
  type: mysql

# Object storage configuration - use built-in MinIO
objectStore:
  provider: minio

minio:
  enabled: false
  auth:
    rootUser: "minio"
    rootPassword: "minio123"
  defaultBuckets: "mlpipeline"
  persistence:
    enabled: true
    size: 20Gi

# Argo Workflows configuration - use built-in
argo:
  enabled: false

# Built-in third-party components
thirdParty:
  mysql:
    enabled: true
  minio:
    enabled: true
    portName: http
  argo:
    enabled: true

# Workflow controller configuration
workflowController:
  priorityClass:
    create: false

# Enable metadata server for standalone deployment
metadata:
  enabled: true
  grpc:
    resources:

# Disable cloud-specific features
monitoring:
  prometheus:
    enabled: false
  grafana:
    enabled: false

certManager:
  enabled: false

networking:
  istio:
    enabled: false

# Disable CRDs for platform-agnostic scenario
crds:
  install: false

# Disable webhooks for platform-agnostic scenario
webhooks:
  enabled: false

apiServer:
  additionalEnv:
    - name: PUBLISH_LOGS
      value: "true"
    - name: LOG_LEVEL
      value: "info"
    - name: PIPELINE_LOG_LEVEL
      value: "1"
    - name: AUTO_UPDATE_PIPELINE_DEFAULT_VERSION
      key: autoUpdatePipelineDefaultVersion
    - name: POD_NAMESPACE
      valueFrom:
        fieldRef:
          fieldPath: metadata.namespace
    - name: OBJECTSTORECONFIG_SECURE
      value: "false"
    - name: OBJECTSTORECONFIG_BUCKETNAME
      key: bucketName
    - name: DBCONFIG_USER
      key: username
    - name: DBCONFIG_PASSWORD
      key: password
    - name: DBCONFIG_DBNAME
      key: pipelineDb
    - name: DBCONFIG_HOST
      key: dbHost
    - name: DBCONFIG_PORT
      key: dbPort
    - name: DBCONFIG_CONMAXLIFETIME
      key: ConMaxLifeTime
    - name: DB_DRIVER_NAME
      key: dbType
    - name: DBCONFIG_MYSQLCONFIG_USER
      key: username
    - name: DBCONFIG_MYSQLCONFIG_PASSWORD
      key: password
    - name: DBCONFIG_MYSQLCONFIG_DBNAME
      key: pipelineDb
    - name: DBCONFIG_MYSQLCONFIG_HOST
      key: mysqlHost
    - name: DBCONFIG_MYSQLCONFIG_PORT
      key: mysqlPort
    - name: OBJECTSTORECONFIG_ACCESSKEY
      key: accesskey
    - name: OBJECTSTORECONFIG_SECRETACCESSKEY
      key: secretkey
    - name: V2_DRIVER_IMAGE
      value: "ghcr.io/kubeflow/kfp-driver:2.14.3"
    - name: V2_LAUNCHER_IMAGE
      value: "ghcr.io/kubeflow/kfp-launcher:2.14.3"
cache:
  server:
    additionalEnv:
      - name: DEFAULT_CACHE_STALENESS
        key: DEFAULT_CACHE_STALENESS
      - name: MAXIMUM_CACHE_STALENESS
        key: MAXIMUM_CACHE_STALENESS
      - name: CACHE_IMAGE
        key: cacheImage
      - name: CACHE_NODE_RESTRICTIONS
        key: cacheNodeRestrictions
      - name: DBCONFIG_DRIVER
        value: "mysql"
      - name: DBCONFIG_DB_NAME
        key: cacheDb
      - name: DBCONFIG_HOST_NAME
        key: dbHost
      - name: DBCONFIG_PORT
        key: dbPort
      - name: DBCONFIG_USER
        key: username
      - name: DBCONFIG_PASSWORD
        key: password
      - name: NAMESPACE_TO_WATCH
        valueFrom:
          fieldRef:
            fieldPath: metadata.namespace
scheduledWorkflow:
  additionalEnv:
    - name: LOG_LEVEL
      value: "info"
    - name: NAMESPACE
      valueFrom:
        fieldRef:
          fieldPath: metadata.namespace
persistenceAgent:
  additionalEnv:
    - name: NAMESPACE
      valueFrom:
        fieldRef:
          fieldPath: metadata.namespace
viewerCrd:
  additionalEnv:
    - name: MAX_NUM_VIEWERS
      value: "50"
    - name: NAMESPACE
      valueFrom:
        fieldRef:
          fieldPath: metadata.namespace
ui:
  additionalEnv:
    - name: VIEWER_TENSORBOARD_POD_TEMPLATE_SPEC_PATH
      value: "/etc/config/viewer-pod-template.json"
    - name: MINIO_NAMESPACE
      valueFrom:
        fieldRef:
          fieldPath: metadata.namespace
    - name: MINIO_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          key: accesskey
          name: mlpipeline-minio-artifact
    - name: MINIO_SECRET_KEY
      valueFrom:
        secretKeyRef:
          key: secretkey
          name: mlpipeline-minio-artifact
    - name: ALLOW_CUSTOM_VISUALIZATIONS
      value: "true"
    - name: FRONTEND_SERVER_NAMESPACE
      valueFrom:
        fieldRef:
          fieldPath: metadata.namespace
    - name: ARGO_ARCHIVE_LOGS
      value: "true"
    - name: DISABLE_GKE_METADATA
      value: "true"