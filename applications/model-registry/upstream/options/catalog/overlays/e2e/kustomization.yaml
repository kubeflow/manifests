apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: model-catalog

resources:
- ../../base

# Replace sources with test sources
configMapGenerator:
- behavior: replace
  files:
  - sources.yaml
  name: model-catalog-sources
  options:
    disableNameSuffixHash: true
- behavior: create
  files:
  - test-catalog.yaml
  - disabled-catalog.yaml
  name: model-catalog-testdata
  options:
    disableNameSuffixHash: true

# Override HF API key (empty for public model access)
secretGenerator:
- behavior: replace
  name: model-catalog-hf-api-key
  envs:
  - hf-api-key.env
  options:
    disableNameSuffixHash: true

# Patch deployment for local testing
patches:
# Add testdata volume mount
- target:
    group: apps
    version: v1
    kind: Deployment
    name: model-catalog-server
  patch: |-
    - op: add
      path: /spec/template/spec/volumes/-
      value:
        name: testdata
        configMap:
          name: model-catalog-testdata
    - op: add
      path: /spec/template/spec/containers/0/volumeMounts/-
      value:
        name: testdata
        mountPath: /testdata

# Image override is done via `kustomize edit set image` in Makefile
# to support both Docker and Podman environments

