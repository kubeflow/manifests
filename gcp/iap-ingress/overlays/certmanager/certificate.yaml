apiVersion: certmanager.k8s.io/v1alpha1
kind: Certificate
metadata:
  name: $(ConfigMap.parameters.data.tlsSecretName)
spec:
  acme:
    config:
    - domains:
      - $(KfDef.app.applications[name=iap-ingress].kustomizeConfig.parameters[name=hostname].value)
      http01:
        ingress: $(ConfigMap.parameters.data.ingressName)
  commonName: $(KfDef.app.applications[name=iap-ingress].kustomizeConfig.parameters[name=hostname].value)
  dnsNames:
  - $(KfDef.app.applications[name=iap-ingress].kustomizeConfig.parameters[name=hostname].value)
  issuerRef:
    kind: ClusterIssuer
    name: $(ConfigMap.parameters.data.issuer)
  secretName: $(ConfigMap.parameters.data.tlsSecretName)
