apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: auth

resources:
- ../../base
- virtual-service.yaml

replacements:
- source:
    version: v1
    kind: Service
    name: dex
    fieldPath: metadata.name
  targets:
  - fieldPaths:
    - spec.rules.0.backendRefs.0.name
    select:
      version: v1beta1
      group: gateway.networking.k8s.io
      kind: HTTPRoute
      name: dex
