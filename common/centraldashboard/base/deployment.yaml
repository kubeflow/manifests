apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: centraldashboard
  name: centraldashboard
spec:
  replicas: 1
  selector:
    matchLabels:
      app: centraldashboard
  template:
    metadata:
      labels:
        app: centraldashboard
      annotations:
        sidecar.istio.io/inject: "false"
    spec:
      containers:
      - image: gcr.io/kubeflow-images-public/centraldashboard
        imagePullPolicy: IfNotPresent
        livenessProbe:
          httpGet:
            path: /healthz
            port: 8082
          initialDelaySeconds: 30
          periodSeconds: 30
        name: centraldashboard
        ports:
        - containerPort: 8082
          protocol: TCP
        # TODO(jlewi): I commented these out because we want to start using a global configmap 
        # to set these values (as opposed to an application level config map).
        # We defined a patch mixins/deployment_kf_config.yaml to set the environment variables
        # based on the global config map. We don't want to set them in the base because if we do
        # when we do the merge valueFrom and value both get set.
        #
        # If we wanted to have a "standalone" kustomize package that uses an application level config
        # then we could define an appropriate patch similar to mixins/deployment_app_config.yaml.
        #  I didn't bother with that because we don't have a stanadlone kustomization.yaml file
        # since it doesn't really make sense to do that. 
        # The sole exception might be for backwards compatibility
        #env:
        #- name: USERID_HEADER
        #  value: $(userid-header)
        #- name: USERID_PREFIX
        #  value: $(userid-prefix)
        #- name: PROFILES_KFAM_SERVICE_HOST
        #  value: profiles-kfam.kubeflow
      serviceAccountName: centraldashboard
